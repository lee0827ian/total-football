<!DOCTYPE html>
<html lang="ko">
<head>
    // ...existing code...
</head>
<body>
    <div class="header">
        <h1>âš½ í¬ë©”ì´ì…˜ í¸ì§‘ê¸°</h1>
        <div class="controls">
            <button onclick="location.href='index.html'">â† ë©”ì¸ìœ¼ë¡œ</button>
            <button onclick="resetFormation()">ğŸ”„ ì´ˆê¸°í™”</button>
            <button onclick="saveFormation()">ğŸ’¾ ì €ì¥</button>
        </div>
    </div>

    <div class="stats">
        <span>ì „ì²´ í•„ë“œ ì„ ìˆ˜: <span id="fieldCount">0</span>/33ëª…</span>
    </div>

    <div class="fields-container">
        // ...existing fields container code...
    </div>

    <div class="bench-area">
        <div class="controls" style="text-align: center; margin-bottom: 15px;">
            <!-- ì„ ìˆ˜ ì¶”ê°€ UI -->
            <div class="add-player-controls">
                <input type="text" id="newPlayerName" placeholder="ìƒˆ ì„ ìˆ˜ ì´ë¦„" style="width: 150px;">
                <select id="newPlayerGrade">
                    <option value="T3">T3</option>
                    <option value="T4">T4</option>
                </select>
                <button onclick="addNewPlayer()">â• ì„ ìˆ˜ ì¶”ê°€</button>
            </div>
            <!-- ê²€ìƒ‰ UI -->
            <div>
                <input type="text" id="playerSearch" placeholder="ì„ ìˆ˜ ê²€ìƒ‰..." style="width: 200px;">
                <button onclick="searchPlayer()">ğŸ” ê²€ìƒ‰</button>
                <button onclick="clearSearch()">âŒ ì´ˆê¸°í™”</button>
            </div>
        </div>
        // ...existing bench-container...
    </div>

    <script>
        // ...existing code until enableDropZones...

        function enableDropZones() {
            document.querySelectorAll('.formation-field .line').forEach(zone => {
                const emptyZone = zone.querySelector('.empty-zone');
                const field = zone.closest('.formation-field');
                
                Sortable.create(zone, {
                    group: 'shared',
                    animation: 200,
                    onAdd: function(evt) {
                        // ë¨¼ì € í•„ë“œ ì œí•œ í™•ì¸
                        if (!checkFieldLimit(field)) {
                            const player = evt.item;
                            const grade = player.dataset.grade;
                            const targetBench = grade === 'T3' ? 
                                document.querySelector('#t3Bench .players-container') : 
                                document.querySelector('#t4Bench .players-container');
                            targetBench.appendChild(player);
                            return;
                        }

                        if (emptyZone) emptyZone.style.display = 'none';
                        limitPlayers(zone);
                        updateStats();
                    },
                    onRemove: function() {
                        if (zone.querySelectorAll('.player').length === 0 && emptyZone) {
                            emptyZone.style.display = 'block';
                        }
                        updateStats();
                    }
                });
            });

            // ...existing bench containers code...
        }

        function checkFieldLimit(field) {
            const playerCount = field.querySelectorAll('.player').length;
            if (playerCount >= 11) {
                alert('í•œ íŒ€ë‹¹ ìµœëŒ€ 11ëª…ê¹Œì§€ë§Œ ë°°ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return false;
            }
            return true;
        }

        function addNewPlayer() {
            const name = document.getElementById('newPlayerName').value.trim();
            const grade = document.getElementById('newPlayerGrade').value;
            
            if (!name) {
                alert('ì„ ìˆ˜ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ì¤‘ë³µ ì´ë¦„ ì²´í¬
            const isDuplicate = players.some(p => p.nick.toLowerCase() === name.toLowerCase());
            if (isDuplicate) {
                alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì„ ìˆ˜ ì´ë¦„ì…ë‹ˆë‹¤.');
                return;
            }

            // ìƒˆ ì„ ìˆ˜ ê°ì²´ ìƒì„±
            const div = document.createElement('div');
            div.className = `player ${grade.toLowerCase()}`;
            div.textContent = name;
            div.dataset.nick = name;
            div.dataset.grade = grade;

            const newPlayer = {
                nick: name,
                grade: grade,
                element: div
            };

            // players ë°°ì—´ì— ì¶”ê°€
            players.push(newPlayer);

            // UI ê°±ì‹ 
            renderBench();
            
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('newPlayerName').value = '';
        }

        function updateStats() {
            // ...existing updateStats code...

            // ê° í•„ë“œë³„ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
            ['field1', 'field2', 'field3'].forEach(fieldId => {
                const count = document.querySelector(`#${fieldId}`).querySelectorAll('.player').length;
                document.querySelector(`#${fieldId}Count`).textContent = `(${count}/11ëª…)`;
            });
        }

        // ...existing event listeners...

        // ì„ ìˆ˜ ì¶”ê°€ Enter í‚¤ ì´ë²¤íŠ¸
        document.getElementById('newPlayerName').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addNewPlayer();
            }
        });
    </script>
</body>
</html>
