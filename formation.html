<!DOCTYPE html>
<html lang="ko">
<head>
    // ...existing code...
</head>
<body>
    <div class="header">
        <h1>⚽ 포메이션 편집기</h1>
        <div class="controls">
            <button onclick="location.href='index.html'">← 메인으로</button>
            <button onclick="resetFormation()">🔄 초기화</button>
            <button onclick="saveFormation()">💾 저장</button>
        </div>
    </div>

    <div class="stats">
        <span>전체 필드 선수: <span id="fieldCount">0</span>/33명</span>
    </div>

    <div class="fields-container">
        // ...existing fields container code...
    </div>

    <div class="bench-area">
        <div class="controls" style="text-align: center; margin-bottom: 15px;">
            <!-- 선수 추가 UI -->
            <div style="margin-bottom: 15px;">
                <input type="text" id="newPlayerName" placeholder="새 선수 이름" 
                       style="padding: 8px; border-radius: 6px; border: 1px solid #ccc; width: 150px; margin-right: 10px;">
                <select id="newPlayerGrade" style="padding: 8px; border-radius: 6px; border: 1px solid #ccc; margin-right: 10px;">
                    <option value="T3">T3</option>
                    <option value="T4">T4</option>
                </select>
                <button onclick="addNewPlayer()">➕ 선수 추가</button>
            </div>
            <!-- 검색 UI -->
            <div>
                <input type="text" id="playerSearch" placeholder="선수 검색..." 
                       style="padding: 8px; border-radius: 6px; border: 1px solid #ccc; width: 200px; margin-right: 10px;">
                <button onclick="searchPlayer()">🔍 검색</button>
                <button onclick="clearSearch()">❌ 초기화</button>
            </div>
        </div>
        <div class="bench-container">
            <div class="bench-group" id="t3Bench">
                <h3>T3 선수단 <span class="player-count" id="t3Count">(0명)</span></h3>
                <div class="players-container"></div>
            </div>
            <div class="bench-group" id="t4Bench">
                <h3>T4 선수단 <span class="player-count" id="t4Count">(0명)</span></h3>
                <div class="players-container"></div>
            </div>
        </div>
    </div>

    <script>
        let players = [];

        fetch('players.json')
            .then(res => res.json())
            .then(json => {
                console.log('데이터 로드 성공:', json.length + '명의 선수 데이터');
                initializePlayers(json);
            })
            .catch(err => {
                console.error('players.json 파일을 찾을 수 없습니다:', err);
                alert('선수 데이터를 불러올 수 없습니다. players.json 파일을 확인해주세요.');
            });

        function initializePlayers(data) {
            players = data.filter(p => p.grade === 'T3' || p.grade === 'T4').map(p => {
                const div = document.createElement('div');
                div.className = `player ${p.grade.toLowerCase()}`;
                div.textContent = p.nick;
                div.dataset.nick = p.nick;
                div.dataset.grade = p.grade;
                return { ...p, element: div };
            });
            
            renderBench();
            enableDropZones();
            updateStats();
        }

        function addNewPlayer() {
            const name = document.getElementById('newPlayerName').value.trim();
            const grade = document.getElementById('newPlayerGrade').value;
            
            if (!name) {
                alert('선수 이름을 입력해주세요.');
                return;
            }

            // 중복 이름 체크
            const isDuplicate = players.some(p => p.nick.toLowerCase() === name.toLowerCase());
            if (isDuplicate) {
                alert('이미 존재하는 선수 이름입니다.');
                return;
            }

            // 새 선수 객체 생성
            const div = document.createElement('div');
            div.className = `player ${grade.toLowerCase()}`;
            div.textContent = name;
            div.dataset.nick = name;
            div.dataset.grade = grade;

            const newPlayer = {
                nick: name,
                grade: grade,
                element: div
            };

            // players 배열에 추가
            players.push(newPlayer);

            // UI 갱신
            renderBench();
            
            // 입력 필드 초기화
            document.getElementById('newPlayerName').value = '';
        }

        // ...existing functions...

        document.addEventListener('DOMContentLoaded', function() {
            // 기존 검색 이벤트
            document.getElementById('playerSearch').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchPlayer();
                }
            });

            // 선수 추가 이벤트
            document.getElementById('newPlayerName').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addNewPlayer();
                }
            });
        });
    </script>
</body>
</html>
