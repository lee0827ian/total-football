<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>스페셜매치 등급표</title>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            padding: 20px;
            background-color: #f9f9f9;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
        }
        h2 {
            margin-top: 30px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
            font-size: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            grid-column: 1 / -1;
        }
        .group {
            background: #fff;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            min-height: 40px;
        }
        .player {
            padding: 8px 12px;
            background-color: #e6f0ff;
            border-radius: 8px;
            cursor: grab;
            user-select: none;
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: transform 0.2s;
        }
        .player:hover {
            transform: translateX(5px);
            background-color: #d0e7ff;
        }
        .controls {
            margin-bottom: 15px;
        }
        input[type="text"] {
            padding: 8px;
            border-radius: 8px;
            border: 1px solid #ccc;
            margin-right: 10px;
            width: 200px;
        }
        button {
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            background-color: #4caf50;
            color: white;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        button:hover {
            background-color: #45a049;
        }
        .empty-group {
            display: none;
        }
        
        @media (max-width: 768px) {
            .group {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            body {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="controls" style="display: flex; align-items: center; gap: 10px;">
        <input type="text" id="search" placeholder="닉네임 검색">
        <button onclick="location.href='formation.html'" style="padding: 10px 20px; font-size: 1.1em;">
            ⚽ T4매치 포메이션
        </button>
    </div>

    <div id="groupsContainer"></div>

    <script>
        let data = [];
        const allGrades = ['T1', 'T2', 'T3', 'T4'];
        const groupsContainer = document.getElementById('groupsContainer');

        function render(players = data) {
            groupsContainer.innerHTML = '';
            const grouped = groupByGrade(players);
            
            allGrades.forEach(grade => {
                const players = grouped[grade] || [];
                if (players.length === 0 && (grade === 'T1' || grade === 'T2')) {
                    return;
                }

                const group = document.createElement('div');
                group.className = `group ${players.length === 0 ? 'empty-group' : ''}`;
                group.id = grade;
                
                const count = players.length;
                group.innerHTML = `
                    <h2>
                        ${grade}
                        <span style="font-size:14px; color:#888;">(${count}명)</span>
                    </h2>
                `;
                
                players.forEach(player => {
                    const div = document.createElement('div');
                    div.className = 'player';
                    div.textContent = player.nick;
                    div.dataset.nick = player.nick;
                    group.appendChild(div);
                });

                groupsContainer.appendChild(group);

                new Sortable(group, {
                    group: 'shared',
                    animation: 150,
                    onAdd: function(evt) {
                        const nick = evt.item.dataset.nick;
                        const newGrade = evt.to.id;
                        const player = data.find(p => p.nick === nick);
                        if (player) {
                            player.grade = newGrade;
                            render();
                        }
                    }
                });
            });
        }

        function groupByGrade(players) {
            return players.reduce((groups, player) => {
                if (!groups[player.grade]) {
                    groups[player.grade] = [];
                }
                groups[player.grade].push(player);
                return groups;
            }, {});
        }

        document.getElementById('search').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const filtered = data.filter(player => 
                player.nick.toLowerCase().includes(searchTerm)
            );
            render(filtered);
        });

        fetch('players.json')
            .then(res => res.json())
            .then(json => {
                data = json;
                render();
            })
            .catch(err => {
                console.error('데이터 로드 실패:', err);
                groupsContainer.innerHTML = `
                    <p style="color: red; text-align: center; padding: 20px;">
                        데이터를 불러오는데 실패했습니다. 페이지를 새로고침 해주세요.
                    </p>`;
            });
    </script>
</body>
</html>
